box: wercker-labs/docker
build:
  steps:
    - install-packages:
        packages: lxc-docker=1.4.1
    - script:
        name: print system-wide docker info
        code: |
          docker version
          docker info
          docker images
    - script:
        name: build all images
        code: script/build-all.sh
    - script:
        name: test all images
        code: script/test-all.sh
    - zvelo/docker-save:
        image: jumanjiman/duoauthproxy:centos6
    - zvelo/docker-save:
        image: jumanjiman/duoauthproxy:centos7
    - zvelo/docker-save:
        image: jumanjiman/duoauthproxy:ubuntu
deploy:
  steps:
    - zvelo/docker-hub-push:
        image: jumanjiman/duoauthproxy:centos6
        email: ${email}
        password: ${password}
        username: jumanjiman
    - zvelo/docker-hub-push:
        image: jumanjiman/duoauthproxy:centos7
        email: ${email}
        password: ${password}
        username: jumanjiman
    - zvelo/docker-hub-push:
        image: jumanjiman/duoauthproxy:ubuntu
        email: ${email}
        password: ${password}
        username: jumanjiman
